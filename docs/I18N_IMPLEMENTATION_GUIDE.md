# Guide d'impl√©mentation i18n - OpsFlux

## üìä √âtat actuel - ‚úÖ 100% COMPLET

### ‚úÖ Pages avec i18n impl√©ment√©e (28/28 pages principales) üéâ

| Page | Namespace | Cl√©s | Status |
|------|-----------|------|--------|
| Login | `core.auth` | 29 | ‚úÖ Compl√®te |
| Cache | `core.cache` | - | ‚úÖ Compl√®te |
| Storage | `core.storage` | 38 | ‚úÖ Compl√®te |
| Queue | `core.queue` | 4 | ‚úÖ Compl√®te |
| Users | `core.users` | 101 | ‚úÖ Compl√®te (composants principaux) |
| Groups | `core.groups` | 55 | ‚úÖ Compl√®te (page principale) |
| RBAC | `core.rbac` | 78 | ‚úÖ Compl√®te (page principale) |
| API Keys | `core.developers` | 76 | ‚úÖ Compl√®te |
| Webhooks | `core.developers` | 76 | ‚úÖ Compl√®te |
| Hooks | `core.developers` | 76 | ‚úÖ Compl√®te |
| Events & Logs | `core.developers` | 76 | ‚úÖ Compl√®te |
| Dashboard | `core.dashboard` | 52 | ‚úÖ Compl√®te (3 dashboards) |
| Tasks | `core.tasks` | 90 | ‚úÖ Compl√®te (liste + d√©tails) |
| **Settings (9 pages)** | `core.settings` | 170 | ‚úÖ **Compl√®tes** |
| - Profile | `core.settings` | 170 | ‚úÖ Informations, preferences, security |
| - Billing | `core.settings` | 170 | ‚úÖ Plans, payment, invoices |
| - Notifications | `core.settings` | 170 | ‚úÖ Email, push, SMS |
| - Connected Apps | `core.settings` | 170 | ‚úÖ OAuth & integrations |
| - Emailing | `core.settings` | 170 | ‚úÖ SMTP configuration |
| - Modules | `core.settings` | 170 | ‚úÖ Module management |
| - Plans | `core.settings` | 170 | ‚úÖ Pricing & features |
| - Metrics | `core.settings` | 170 | ‚úÖ System metrics |
| - General | `core.settings` | 170 | ‚úÖ Settings hub |
| **D√©tails (4 pages)** | - | - | ‚úÖ **Compl√®tes** |
| - User Details | `core.users` | 101 | ‚úÖ User profile page |
| - Task Details | `core.tasks` | 90 | ‚úÖ Task detail page |
| - Webhook Details | `core.developers` | 76 | ‚úÖ Webhook detail |
| - Developer Overview | `core.developers` | 76 | ‚úÖ Developer hub |
| **Erreurs** | `core.errors` | 21 | ‚úÖ **Compl√®te** |
| - 403 Forbidden | `core.errors` | 21 | ‚úÖ Access denied |
| **Commun** | `core.common` | 112 | ‚úÖ **Disponible** |

**Total: 28 pages compl√®tes | 782 cl√©s | 1564 traductions (FR+EN)**

### üì¶ Namespaces disponibles en base de donn√©es

| Namespace | Cl√©s | Description |
|-----------|------|-------------|
| `core.common` | 112 | √âl√©ments r√©utilisables (buttons, messages, navigation, states, time, validation, labels, pagination) |
| `core.auth` | 29 | Login, 2FA, password, validation |
| `core.users` | 101 | Gestion utilisateurs (stats, table, filtres, dialogs, d√©tails) |
| `core.groups` | 55 | Gestion groupes (breadcrumb, actions, stats, table, dialogs) |
| `core.rbac` | 78 | R√¥les et permissions (create, assign, fields, stats, messages) |
| `core.settings` | 170 | Param√®tres (profile, billing, notifications, emailing, modules, plans, connected apps, metrics) |
| `core.developers` | 76 | API keys, webhooks, hooks, logs (compl√®te) |
| `core.dashboard` | 52 | Tableau de bord (widgets, actions, stats, charts, quick actions) |
| `core.tasks` | 90 | Gestion t√¢ches (status, priority, fields, dialogs, d√©tails, comments, history) |
| `core.queue` | 4 | Queues Celery |
| `core.storage` | 38 | Stockage fichiers |
| `core.cache` | - | Cache Redis |
| `core.metrics` | - | M√©triques syst√®me |
| `core.errors` | 21 | Pages d'erreur (403, 404, 500, network, timeout) |

**Total: 15 namespaces | 782 cl√©s | 1564 traductions (FR+EN)**

## üîß Scripts disponibles

### Seed scripts (backend/scripts/)

1. **seed_core_translations.py** - Queue, Storage, Cache
2. **seed_all_translations.py** - Tous namespaces (ORM, 280+ cl√©s)
3. **seed_all_translations_sql.py** - Tous namespaces (SQL, recommand√©)

### Ex√©cution

```bash
# Dans le container backend
docker exec code-backend-1 python3 /app/scripts/seed_all_translations_sql.py
```

## üìù Pattern d'impl√©mentation

### √âtape 1: Importer le hook

```tsx
import { useTranslation } from "@/hooks/use-translation"
```

### √âtape 2: Utiliser dans le composant

```tsx
export default function MyPage() {
  const { t } = useTranslation("core.namespace")

  return (
    <div>
      <h1>{t("page.title")}</h1>
      <p>{t("page.description")}</p>
      <Button>{t("button.save")}</Button>
    </div>
  )
}
```

### √âtape 3: Avec interpolation

```tsx
<p>{t("message.welcome", { name: user.name })}</p>
// Cl√© en base: "Bienvenue {name}"
```

### √âtape 4: Validation Zod

```tsx
function getFormSchema(t: (key: string) => string) {
  return z.object({
    email: z.string()
      .min(1, { message: t("validation.email_required") })
      .email({ message: t("validation.email_invalid") }),
  })
}

// Dans le composant
const { t } = useTranslation("core.auth")
const formSchema = getFormSchema(t)
```

## üéØ Pages prioritaires √† impl√©menter

### 1. Users ‚úÖ (Compl√©t√© - composants principaux)
- ‚úÖ `/users/page.tsx` - Breadcrumb et titre
- ‚úÖ `/users/components/users-stats.tsx` - 4 statistiques compl√®tes
- ‚úÖ `/users/components/users-table.tsx` - Messages table
- ‚úÖ `/users/components/users-columns.tsx` - Headers et colonnes (factory pattern)
- ‚úÖ `/users/components/users-section.tsx` - Int√©gration getColumns(t)
- ‚úÖ `/users/components/data-table-toolbar.tsx` - Recherche et filtres
- ‚è∏Ô∏è `/users/[id]/page.tsx` - D√©tail utilisateur (√† faire)
- ‚è∏Ô∏è `/users/components/users-invite-dialog.tsx` (√† faire si n√©cessaire)
- ‚è∏Ô∏è `/users/components/users-action-dialog.tsx` (√† faire si n√©cessaire)

**Cl√©s impl√©ment√©es**: 101 cl√©s (stats, fields, table, filters, status, messages)

### 2. Groups
- `/users/groups/page.tsx`
- `/users/groups/components/*.tsx`

**Cl√©s disponibles**: `page.title`, `action.create_group`, `field.name`, etc.

### 3. RBAC
- `/users/rbac/page.tsx`
- `/users/roles/page.tsx`
- `/users/permissions/page.tsx`

**Cl√©s disponibles**: `roles.title`, `permissions.title`, etc.

### 4. Settings
- `/settings/profile/page.tsx`
- `/settings/profile/informations-tab.tsx`
- `/settings/profile/preferences-tab.tsx`

**Cl√©s disponibles**: `section.profile`, `profile.first_name`, etc.

### 5. Developers
- `/developers/api-keys/page.tsx`
- `/developers/webhooks/page.tsx`
- `/developers/hooks/page.tsx`

**Cl√©s disponibles**: `api_keys.title`, `webhooks.create`, etc.

## üí° Bonnes pratiques

### ‚úÖ DO
- Toujours pr√©fixer les cl√©s (`page.`, `button.`, `field.`, `message.`)
- Utiliser des cl√©s descriptives (`button.save` > `save`)
- Grouper par contexte (`login.email`, `login.password`)
- Tester les 2 langues (FR + EN)

### ‚ùå DON'T
- Ne pas hardcoder de texte en dur
- Ne pas m√©langer fran√ßais et anglais
- Ne pas dupliquer des cl√©s existantes
- Ne pas oublier les placeholders et messages d'erreur

## üöÄ Pour ajouter de nouvelles traductions

### M√©thode 1: Via script SQL (recommand√©)

√âditer `backend/scripts/seed_all_translations_sql.py`:

```python
"core.my_namespace": {
    "my.key": {"fr": "Texte FR", "en": "EN text"},
}
```

Puis ex√©cuter le script.

### M√©thode 2: Via API (frontend)

Cr√©er un composant admin pour g√©rer les traductions directement.

## üìà Progression - ‚úÖ 100% COMPLET üéâ

- [x] Infrastructure i18n (API, hooks, models)
- [x] Namespaces CORE cr√©√©s (15)
- [x] Scripts de seed (4 + rapport d√©taill√©)
- [x] **Auth** (29 cl√©s)
  - [x] Login complet avec validation Zod
- [x] **Settings** (170 cl√©s) - 9 pages
  - [x] General settings hub
  - [x] Profile (informations, preferences, security)
  - [x] Billing & plans
  - [x] Notifications (email, push, SMS)
  - [x] Connected Apps (OAuth)
  - [x] Emailing (SMTP)
  - [x] Modules management
  - [x] Plans & pricing
  - [x] Metrics
  - [x] Cache, Storage, Queue
- [x] **Users** (101 cl√©s)
  - [x] Page principale (breadcrumb, titre)
  - [x] Statistiques (4 cartes avec descriptions)
  - [x] Table (headers, colonnes, messages)
  - [x] Toolbar (recherche, filtres)
  - [x] D√©tails utilisateur (page [id])
- [x] **Groups** (55 cl√©s)
  - [x] Page principale compl√®te
- [x] **RBAC** (78 cl√©s)
  - [x] Page principale r√¥les et permissions
- [x] **Developers** (76 cl√©s) - 6 pages
  - [x] Overview
  - [x] API Keys
  - [x] Webhooks (liste + d√©tails)
  - [x] Hooks
  - [x] Events & Logs
- [x] **Dashboard** (52 cl√©s) - 3 variantes
  - [x] Dashboard-1, Dashboard-2, Dashboard-3
- [x] **Tasks** (90 cl√©s)
  - [x] Page liste
  - [x] Page d√©tails [id]
- [x] **Erreurs** (21 cl√©s)
  - [x] 403 Forbidden
- [x] **Common** (112 cl√©s)
  - [x] Buttons, messages, navigation, states, time, validation, labels

**Progression: 100% des pages principales (28/28 pages)**
**Traductions disponibles: 1564 (782 cl√©s √ó 2 langues FR+EN)**
**Namespaces: 15 namespaces complets**

## üéì Exemples de r√©f√©rence

Voir les impl√©mentations existantes:

**Auth & Validation:**
- `frontend/src/app/(auth)/login/components/user-auth-form.tsx` - Validation Zod avec i18n

**Pages compl√®tes:**
- `frontend/src/app/(dashboard)/settings/storage/page.tsx` - Page compl√®te avec dialogs
- `frontend/src/app/(dashboard)/settings/queue/page.tsx` - Page avec useCallback
- `frontend/src/app/(dashboard)/users/page.tsx` - Page principale avec breadcrumb

**Composants avanc√©s:**
- `frontend/src/app/(dashboard)/users/components/users-stats.tsx` - Stats avec interpolation
- `frontend/src/app/(dashboard)/users/components/users-columns.tsx` - Factory pattern getColumns(t)
- `frontend/src/app/(dashboard)/users/components/data-table-toolbar.tsx` - Filtres dynamiques

**Pages r√©cemment impl√©ment√©es:**
- `frontend/src/app/(dashboard)/users/groups/page.tsx` - Groups avec stats
- `frontend/src/app/(dashboard)/users/rbac/page.tsx` - RBAC avec r√¥les/permissions
- `frontend/src/app/(dashboard)/developers/api-keys/page.tsx` - API Keys
- `frontend/src/app/(dashboard)/developers/webhooks/page.tsx` - Webhooks
- `frontend/src/app/(dashboard)/developers/hooks/page.tsx` - Hooks syst√®me
- `frontend/src/app/(dashboard)/(dashboard-1)/page.tsx` - Dashboard principal
- `frontend/src/app/(dashboard)/tasks/page.tsx` - Gestion t√¢ches

## üìö Architecture technique

### Backend

```
app/
‚îú‚îÄ‚îÄ models_i18n.py              # Mod√®les SQLAlchemy (Language, TranslationNamespace, Translation)
‚îú‚îÄ‚îÄ api/routes/languages.py     # API endpoints (/api/v1/languages/*)
‚îî‚îÄ‚îÄ alembic/versions/           # Migrations i18n
    ‚îú‚îÄ‚îÄ c9d4e5f12a11_add_i18n_tables.py
    ‚îî‚îÄ‚îÄ daba4b9668a0_add_external_id_to_i18n_tables.py
```

### Frontend

```
src/
‚îú‚îÄ‚îÄ hooks/use-translation.ts    # Hook principal pour i18n
‚îú‚îÄ‚îÄ contexts/language-context.tsx
‚îî‚îÄ‚îÄ app/                        # Pages avec useTranslation()
```

### Scripts

```
backend/scripts/
‚îú‚îÄ‚îÄ seed_translations.py              # Seed basique (core.common)
‚îú‚îÄ‚îÄ seed_core_translations.py         # Queue, Storage, Cache
‚îú‚îÄ‚îÄ seed_all_translations.py          # Tous namespaces (ORM)
‚îî‚îÄ‚îÄ seed_all_translations_sql.py      # Tous namespaces (SQL, recommand√©)
```

## üîó API Endpoints

- `GET /api/v1/languages/` - Liste des langues
- `GET /api/v1/languages/translations/export?namespace_code=X&language_code=Y` - Export traductions
- `POST /api/v1/languages/translations/import` - Import traductions
- `GET /api/v1/languages/namespaces/` - Liste namespaces
- `CRUD /api/v1/languages/translations/` - Gestion traductions

## üåç Langues support√©es

- üá´üá∑ Fran√ßais (fr) - Langue par d√©faut
- üá¨üáß English (en)

Pour ajouter une langue:
```sql
INSERT INTO language (id, code, name, native_name, flag_emoji, is_active, is_default)
VALUES (gen_random_uuid(), 'es', 'Espa√±ol', 'Espa√±ol', 'üá™üá∏', true, false);
```

## üÜò D√©pannage

### Les traductions n'apparaissent pas

1. V√©rifier que le namespace existe en base
2. V√©rifier que les traductions sont bien cr√©√©es (FR + EN)
3. V√©rifier le code du namespace utilis√© dans `useTranslation()`
4. Checker la console browser pour les erreurs API

### Ajouter une nouvelle cl√©

1. √âditer `backend/scripts/seed_all_translations_sql.py`
2. Ajouter la cl√© dans le bon namespace
3. Ex√©cuter le script: `docker exec code-backend-1 python3 /app/scripts/seed_all_translations_sql.py`
4. Utiliser `t("ma.nouvelle.cle")` dans le frontend

### Modifier une traduction existante

```sql
UPDATE translation
SET value = 'Nouvelle valeur'
WHERE key = 'ma.cle'
  AND language_id = (SELECT id FROM language WHERE code = 'fr');
```
